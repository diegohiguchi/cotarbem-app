<ion-view cache-view="false" hide-back-button="true" ng-controller="cotacao.solicitacao.produto.leilao as vm">
    <ion-nav-title>
        {{vm.produtoSelecionado.categoriaNome}} - Cotação
    </ion-nav-title>
    <ion-nav-buttons side="left">
        <a class="button icon-left ion-chevron-left button-clear" ng-href="javascript:" ng-click="vm.voltarPagina()"></a>
    </ion-nav-buttons>
     <ion-nav-buttons side="right">
        <a class="" ng-href="javascript:" ng-click="vm.abrirModalImpossivelCotar()">
            <span class="notify">
                <i class="fa fa-question-circle"></i>
            </span>
        </a>
    </ion-nav-buttons>
    <ion-content>
        <div class="center cotacao_view">
            <div class="head_info">
                <!--<div class="imagem" div-imagem="vm.produtoSelecionado">
                </div>-->
                <div class="imagem">
                    <span ng-if="vm.produtoSelecionado.produto.urlImagem == null">
					   <img src="img/placehold_image.png" />
                    </span>
                    <span ng-if="vm.produtoSelecionado.produto.urlImagem != null">
                        <a href="javascript:" ng-click="vm.ampliarImagem('zoomIn')">
					        <img data-ng-src="{{vm.produtoSelecionado.produto.urlImagem}}" class="imagem-leilao"/>
                        </a>
                    </span>
                </div>
                <p class="title cor_default">{{vm.produtoSelecionado.produto.nome}}</p>
                <span><strong>Tipo:</strong> {{vm.produtoSelecionado.produto.tipoCotacao.nome}} - 
                <strong>Quantidade:</strong> {{vm.produtoSelecionado.produto.quantidade}}</span>
                <span><strong>Data de entrega:</strong> {{vm.produtoSelecionado.produto.dataEntrega | date:"MM/dd/yyyy"}}</span>

                <hr class="space" />

                <span ng-show="!vm.mostraDescricao">{{vm.produtoSelecionado.produto.descricao | cut:true:100:' ...'}} 
                    <a href="javascript:" ng-show="vm.produtoSelecionado.produto.descricao.length > 100" ng-click="vm.mostraDescricao = !vm.mostraDescricao">+ ver mais</a>
                </span>
                <span ng-show="!!vm.mostraDescricao">{{vm.produtoSelecionado.produto.descricao}} 
                    <a href="javascript:" ng-click="vm.mostraDescricao = !vm.mostraDescricao">- ver menos</a>
                </span>

                <div class="clear"></div>
            </div>
            <div class="clear"></div>
        </div>

        <!--<a href="#" class="impossivel_cotar">Impossível Cotar?</a>-->

        <p class="tempo_cotacao">TEMPO PARA COTAÇÃO
            <span class="temp_cotacao" ng-show="!!vm.produtoSelecionado.ativo" my-current-time="vm.produtoSelecionado"></span>
            <span class="temp_cotacao" ng-show="!vm.produtoSelecionado.ativo">encerrado</span>
        </p>
        
        <ul class="list_leilao" ng-show="!!vm.cotacao">
            <li ng-repeat="lance in vm.primeirosLances" class="{{$index | posicao}}">
                <span class="left"><i class="fa fa-trophy"></i></span>
                <span class="left" ng-show="!lance.posicao">{{$index + 1}}º </span>
                <span class="left" ng-show="!!lance.posicao">{{lance.posicao + 1}}º </span>
                <span class="left" lance-usuario-nome="lance"></span>
                <span class="right">{{lance.valor | currency}}</span>
            </li>
            <li class="quarto" ng-show="!!vm.lanceUsuarioLogado">
                <span class="left"><i class="fa fa-trophy"></i></span>
                <span class="left">{{vm.lanceUsuarioLogado.posicao}}º - SEU LANCE</span>
                <span class="right">{{vm.lanceUsuarioLogado.valor | currency}}</span>
            </li>
            <!--<div class="clear" ng-show="formLance.$submitted">
                <div ng-messages="formLance.$error">
                    <div ng-messages-include="error-list.html"></div>
                </div>
            </div>-->
        </ul>
    </ion-content>

    <ion-footer-bar>
        <form class="form_lance" name="formLance" novalidate ng-submit="vm.enviarLance(vm.valor)">
            <input type="text" ng-disabled="vm.quantidadeLances.length >= 3 || !vm.produtoSelecionado.ativo" name="valor" ng-model="vm.valor" placeholder="Lance: R$ 0,00" ui-money-mask="2" maxlength="11" required/>
            <button type="submit" ng-disabled="vm.quantidadeLances.length >= 3 || !vm.produtoSelecionado.ativo" ng-class="!vm.produtoSelecionado.ativo || vm.quantidadeLances.length >= 3 ? 'btn_enviar_disabled' : 'btn_enviar'">
                <i class="fa fa-gavel"></i>
            </button>
            <!--<script id="error-list.html" type="text/ng-template">
                <div ng-message="required">
                    <span class="alert_error">
                    <i class="fa fa-exclamation-triangle"></i>
                    Informe o valor do lance
                    </span>
                </div>
                <div ng-message when="valor">
                    <i class="fa fa-exclamation-triangle"></i> Valor inválido
                    </span>
                </div>
            </script>-->
        </form>
    </ion-footer-bar>
    <script id="impossivelCotar.html" type="text/ng-template">
        <ion-modal-view>
            <ion-content>
                <div class="header">
                    <h1>Impossível cotar?</h1>
                    <a href="#" class="" ng-click="vm.fecharModalImpossivelCotar()">
                        <span class="notify">
				        <i class="fa fa-times"></i>
                    </span>
                    </a>
                </div>

                <form novalidate name="formImpossivelCotar" ng-submit="formImpossivelCotar.$valid && vm.enviarMotivoImpossivelCotar(vm.descricao, formImpossivelCotar)">
                    <div class="form_padrao">
                        <div class="clear">
                            <textarea name="descricao" required maxlength="300" ng-model="vm.descricao" placeholder="Descrição detalhada *"></textarea>
                        </div>
                        <div class="clear" ng-show="formImpossivelCotar.$submitted">
                            <div ng-messages="formImpossivelCotar.$error">
                                <div ng-messages-include="error-list.html"></div>
                            </div>

                            <hr class="space">

                        </div>

                        <div class="clear">
                            <input class="btn_padrao" type="submit" value="Enviar" />
                        </div>
                    </div>

                    <script id="error-list.html" type="text/ng-template">
                        <div ng-message="required">
                            <span class="alert_error">
                            <i class="fa fa-exclamation-triangle"></i> Informe o campo descrição
                            </span>
                        </div>
                    </script>
                </form>
            </ion-content>
        </ion-modal-view>
    </script>

    <script id="imagem.html" type="text/ng-template">

        <div class="modal image-modal transparent">
            <a href="javascript:" ng-click="vm.fecharImagem()"  class="icone-fechar-imagem"><i class="fa fa-times"></i></a>

            <img ng-src="{{vm.produtoSelecionado.produto.urlImagem}}" class="fullscreen-image"/>
        </div>
    </script>

</ion-view>